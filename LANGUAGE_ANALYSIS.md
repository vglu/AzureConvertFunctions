# Анализ выбора языка реализации для Azure Convert Functions

## Реализованные функции

1. **csv2json** - Конвертация CSV → JSON
2. **json2csv** - Конвертация JSON → CSV
3. **md2html** - Конвертация Markdown → HTML
4. **html2pdf** - Конвертация HTML → PDF (с поддержкой Unicode/Cyrillic)
5. **url2pdf** - Конвертация URL → PDF (с рендерингом JavaScript через Playwright)
6. **url2jpg** - Создание скриншотов веб-страниц
7. **swagger** - Swagger UI документация

## Использованные технологии (Python)

### Библиотеки:
- `pandas` - обработка CSV/JSON данных
- `markdown` - конвертация Markdown
- `xhtml2pdf` - генерация PDF из HTML
- `bleach` - очистка HTML
- `requests` - HTTP запросы
- `playwright` - рендеринг JavaScript (headless браузер)
- `reportlab` (через xhtml2pdf) - работа со шрифтами

### Особенности реализации:
- Кроссплатформенность (Windows/Linux)
- Поддержка Unicode и Cyrillic символов
- Обработка динамического контента через Playwright
- Агрессивная очистка CSS для совместимости с xhtml2pdf
- Загрузка и встраивание изображений в PDF

## Проблемы, с которыми столкнулись

### 1. Ограничения xhtml2pdf:
- Не поддерживает современные CSS функции (`calc()`, `var()`, `@keyframes`)
- Проблемы с парсингом сложных CSS селекторов
- Ограниченная поддержка data URI для изображений
- Требует временные файлы для изображений

### 2. Проблемы окружения:
- Конфликты версий Python (3.9 vs 3.10)
- Проблемы с grpc в Azure Functions Core Tools
- Необходимость установки системных зависимостей для Playwright

### 3. Сложность реализации:
- Много кода для очистки и нормализации CSS
- Работа с временными файлами для изображений
- Сложная логика обработки шрифтов

## Сравнение языков для Azure Functions

### Python ✅ (Текущий выбор)

**Плюсы:**
- ✅ Отличная экосистема библиотек для всех задач
- ✅ `pandas` - лучший инструмент для CSV/JSON
- ✅ `playwright` - мощный инструмент для рендеринга JS
- ✅ Простота разработки и отладки
- ✅ Хорошая поддержка Unicode из коробки
- ✅ Активное сообщество и документация
- ✅ Кроссплатформенность

**Минусы:**
- ❌ xhtml2pdf имеет ограничения (но это проблема библиотеки, не языка)
- ❌ Проблемы с окружением Azure Functions (но решаемы)
- ❌ Медленнее чем компилируемые языки (но для этих задач не критично)

**Оценка: 9/10** - Отличный выбор для данных задач

---

### Node.js/TypeScript

**Плюсы:**
- ✅ Отличная поддержка в Azure Functions
- ✅ Много библиотек для PDF (puppeteer, pdfkit, jsPDF)
- ✅ Playwright/Puppeteer - нативные инструменты
- ✅ Быстрая разработка
- ✅ Хорошая производительность

**Минусы:**
- ❌ Pandas эквивалент (csv-parser) менее мощный
- ❌ Сложнее работа с бинарными данными
- ❌ Меньше библиотек для обработки данных
- ❌ TypeScript добавляет сложность

**Оценка: 7/10** - Хороший выбор, но хуже для CSV/JSON обработки

**Библиотеки для Node.js:**
- `csv-parser` / `csv-writer` - CSV обработка
- `puppeteer` / `playwright` - рендеринг и PDF
- `marked` - Markdown
- `pdfkit` / `jsPDF` - генерация PDF

---

### C# (.NET)

**Плюсы:**
- ✅ Отличная поддержка в Azure (родной язык)
- ✅ Высокая производительность
- ✅ Сильная типизация
- ✅ Хорошие библиотеки для PDF (iTextSharp, QuestPDF)

**Минусы:**
- ❌ Сложнее для быстрой разработки
- ❌ Меньше библиотек для веб-скрапинга
- ❌ Playwright для C# менее популярен
- ❌ Сложнее работа с CSV/JSON (хотя есть библиотеки)

**Оценка: 7/10** - Хорош для enterprise, но сложнее для прототипирования

**Библиотеки для C#:**
- `CsvHelper` - CSV обработка
- `PlaywrightSharp` - рендеринг
- `iTextSharp` / `QuestPDF` - PDF генерация
- `Markdig` - Markdown

---

### Java

**Плюсы:**
- ✅ Отличная поддержка в Azure
- ✅ Много библиотек для PDF (Apache PDFBox, iText)
- ✅ Высокая производительность
- ✅ Сильная экосистема

**Минусы:**
- ❌ Многословный синтаксис
- ❌ Сложнее для быстрой разработки
- ❌ Playwright для Java менее популярен
- ❌ Сложнее работа с CSV/JSON

**Оценка: 6/10** - Хорош для enterprise, но избыточен для этих задач

---

## Рекомендация: Python ✅

### Почему Python остается лучшим выбором:

1. **Экосистема библиотек:**
   - `pandas` - лучший инструмент для CSV/JSON обработки
   - `playwright` - отличная поддержка и документация
   - `markdown` - зрелая библиотека
   - Богатая экосистема для всех задач

2. **Простота разработки:**
   - Читаемый код
   - Быстрое прототипирование
   - Легкая отладка

3. **Кроссплатформенность:**
   - Работает на Windows, Linux, macOS
   - Легко тестировать локально

4. **Поддержка Unicode:**
   - Отличная поддержка из коробки
   - Легко работать с различными кодировками

5. **Активное сообщество:**
   - Много примеров и решений
   - Хорошая документация

### Альтернативные решения для проблем:

#### Проблема с xhtml2pdf:
- **Альтернатива 1:** Использовать `weasyprint` (но требует системные зависимости)
- **Альтернатива 2:** Использовать `pdfkit` + `wkhtmltopdf` (но требует установку бинарников)
- **Альтернатива 3:** Использовать Playwright для генерации PDF напрямую (лучший вариант!)

#### Улучшение: Использовать Playwright для PDF

Вместо xhtml2pdf можно использовать Playwright напрямую для генерации PDF:

```python
from playwright.sync_api import sync_playwright

def url2pdf_playwright(url: str) -> bytes:
    with sync_playwright() as p:
        browser = p.chromium.launch(headless=True)
        page = browser.new_page()
        page.goto(url)
        pdf_bytes = page.pdf(format='A4')
        browser.close()
        return pdf_bytes
```

**Преимущества:**
- ✅ Полная поддержка современного CSS
- ✅ Правильный рендеринг JavaScript
- ✅ Встроенная поддержка изображений
- ✅ Лучшее качество PDF
- ✅ Меньше кода для очистки CSS

**Недостатки:**
- ❌ Больше размер зависимостей
- ❌ Требует больше памяти

## Итоговая рекомендация

### Python остается лучшим выбором ✅

**Причины:**
1. Лучшая экосистема для данных задач
2. Простота разработки и поддержки
3. Отличная поддержка всех необходимых библиотек
4. Кроссплатформенность

**Рекомендации по улучшению:**
1. Рассмотреть переход с `xhtml2pdf` на `Playwright PDF` для лучшего качества
2. Упростить код, убрав сложную очистку CSS
3. Использовать Playwright для всех PDF операций

### Если бы нужно было выбрать другой язык:

**Node.js/TypeScript** был бы вторым выбором:
- Хорошая поддержка Playwright/Puppeteer
- Много библиотек для PDF
- Но хуже для CSV/JSON обработки

## Заключение

Python - правильный выбор для данного проекта. Проблемы, с которыми столкнулись, связаны с ограничениями библиотеки `xhtml2pdf`, а не с языком. Переход на Playwright для генерации PDF решит большинство проблем и упростит код.

